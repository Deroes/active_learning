[~, inference_method, mean_function, covariance_function, likelihood] = ...
    check_gp_arguments(hyperparameters, inference_method, ...
                       mean_function, covariance_function, likelihood, ...
                       data, responses);

prior_covariances = zeros(num_observations, num_observations, ...
          size(hypersamples.values, 1));
for i = 1:size(hypersamples.values, 1)
  prior_covariances(:, :, i) = ...
  feval(covariance_function{:}, ...
        hypersamples.values(i, hypersamples.covariance_ind), ...
        data);
end

[purely_random_estimated_proportion purely_random_proportion_variance ...
 purely_random_chosen] = purely_random_surveying_discrete(responses, ...
        in_train, num_evaluations);

disp(['purely random sampling: ' num2str(purely_random_estimated_proportion) ...
      ' +/- ' num2str(sqrt(purely_random_proportion_variance)) ...
      ', actual: ' num2str(actual_proportion)]);

proportion_estimation_function = @(data, responses, in_train) ...
    gp_estimate_proportion_discrete(data, responses, in_train, ...
        prior_covariances, inference_method, mean_function, ...
        covariance_function, likelihood, hypersamples, num_f_samples);

utility_function = @random_utility_discrete;
probability_function = @(data, responses, in_train) ...
    gp_probability_discrete(data, responses, in_train, prior_covariances, ...
                            inference_method, mean_function, ...
                            covariance_function, likelihood, hypersamples);

[random_estimated_proportions random_proportion_variances random_chosen] ...
    = iterative_surveying_discrete(data, responses, in_train, ...
        utility_function, proportion_estimation_function, num_evaluations);

random_predictions = ...
    probability_function(data, responses, random_chosen);
random_likelihood = ...
    sum(log(random_predictions(responses(~random_chosen) == 1))) + ...
    sum(log(1 - random_predictions(responses(~random_chosen) == -1)));

disp(['random sampling: ' num2str(random_estimated_proportions(end)) ...
      ' +/- ' num2str(sqrt(random_proportion_variances(end))) ...
      ', actual: ' num2str(actual_proportion) ...
      ', test likelihood: ' num2str(random_likelihood)]);

utility_function = @(data, responses, in_train) ...
    uncertainty_utility_discrete(data, responses, in_train, ...
        probability_function);

[uncertainty_estimated_proportions uncertainty_proportion_variances ...
 uncertainty_chosen] = iterative_surveying_discrete(data, responses, ...
        in_train, utility_function, proportion_estimation_function, ...
        num_evaluations);

uncertainty_predictions = ...
    probability_function(data, responses, uncertainty_chosen);
uncertainty_likelihood = ...
    sum(log(uncertainty_predictions(responses(~uncertainty_chosen) == 1))) + ...
    sum(log(1 - uncertainty_predictions(responses(~uncertainty_chosen) == -1)));

disp(['uncertainty sampling: ' num2str(uncertainty_estimated_proportions(end)) ...
      ' +/- ' num2str(sqrt(uncertainty_proportion_variances(end))) ...
      ', actual: ' num2str(actual_proportion) ...
      ', test likelihood: ' num2str(uncertainty_likelihood)]);

utility_function = @(data, responses, in_train) ...
    battleship_utility_discrete(data, responses, in_train, ...
        probability_function);

[battleship_estimated_proportions battleship_proportion_variances ...
 battleship_chosen] = iterative_surveying_discrete(data, responses, ...
        in_train, utility_function, proportion_estimation_function, ...
        num_evaluations);

battleship_predictions = ...
    probability_function(data, responses, battleship_chosen);
battleship_likelihood = ...
    sum(log(battleship_predictions(responses(~battleship_chosen) == 1))) + ...
    sum(log(1 - battleship_predictions(responses(~battleship_chosen) == -1)));

disp(['battleship sampling: ' num2str(battleship_estimated_proportions(end)) ...
      ' +/- ' num2str(sqrt(battleship_proportion_variances(end))) ...
      ', actual: ' num2str(actual_proportion) ...
      ', test likelihood: ' num2str(battleship_likelihood)]);

utility_function = @(data, responses, in_train) ...
    optimal_utility_discrete(data, responses, in_train, ...
                             probability_function, ...
                             proportion_estimation_function);

[optimal_estimated_proportions optimal_proportion_variances ...
 optimal_chosen] = iterative_surveying_discrete(data, responses, ...
        in_train, utility_function, proportion_estimation_function, ...
        num_evaluations, true);

optimal_predictions = ...
    probability_function(data, responses, optimal_chosen);
optimal_likelihood = ...
    sum(log(optimal_predictions(responses(~optimal_chosen) == 1))) + ...
    sum(log(1 - optimal_predictions(responses(~optimal_chosen) == -1)));

disp(['optimal sampling: ' num2str(optimal_estimated_proportions(end)) ...
      ' +/- ' num2str(sqrt(optimal_proportion_variances(end))) ...
      ', actual: ' num2str(actual_proportion) ...
      ', test likelihood: ' num2str(optimal_likelihood)]);