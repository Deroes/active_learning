initialize;

results_directory = 'results/2';

num_experiments = 200;

num_observations = 250;
dimension = 2;
flip_percentage = 0.05;

num_evaluations = 10;
num_f_samples = 1000;

actual_proportions = zeros(num_experiments, 1);
purely_random_estimated_proportions = zeros(num_experiments, 1);
random_estimated_proportions = zeros(num_experiments, 1);
uncertainty_estimated_proportions = zeros(num_experiments, 1);
battleship_estimated_proportions = zeros(num_experiments, 1);
optimal_estimated_proportions = zeros(num_experiments, 1);

for count = 1:num_experiments
  disp(['experiment ' num2str(count) ' of ' num2str(num_experiments)]);

  data = rand(num_observations, dimension);

  num_circles = randi([1 10], 1);
  centers = rand(num_circles, dimension);
  radii = rand(num_circles) / 2;
  responses = false(num_observations, 1);
  for i = 1:num_circles
    responses = responses | (sum((data - repmat(centers(i, :), ...
            num_observations, 1)).^2, 2) < radii(i).^2);
  end

  actual_proportion = mean(responses);
  responses = 2 * responses - 1;
  
  flip = rand(size(responses)) < flip_percentage;
  responses(flip) = -responses(flip);
  
  disp(['dimension: ' num2str(dimension) ', circles: ' ...
        num2str(num_circles)]);
  
  active_estimation_discrete;

  actual_proportions(count) = actual_proportion;
  purely_random_estimated_proportions(count) = ...
      purely_random_estimated_proportion;
  random_estimated_proportions(count) = random_estimated_proportion;
  uncertainty_estimated_proportions(count) = uncertainty_estimated_proportion;
  battleship_estimated_proportions(count) = battleship_estimated_proportion;
  optimal_estimated_proportions(count) = optimal_estimated_proportion;

  disp(['purely random: mae ' ...
        num2str(mean(abs(actual_proportions(1:count) ...
                         - purely_random_estimated_proportions(1:count)))) ...
        ', rmse ' ...
        num2str(sqrt(mean((actual_proportions(1:count) ...
                         - purely_random_estimated_proportions(1:count)).^2))) ...
        ]);
  disp(['random: mae ' ...
        num2str(mean(abs(actual_proportions(1:count) ...
                         - random_estimated_proportions(1:count)))) ...
        ', rmse ' ...
        num2str(sqrt(mean((actual_proportions(1:count) ...
                         - random_estimated_proportions(1:count)).^2))) ...
        ]);
  disp(['uncertainty: mae ' ...
        num2str(mean(abs(actual_proportions(1:count) ...
                         - uncertainty_estimated_proportions(1:count)))) ...
        ', rmse ' ...
        num2str(sqrt(mean((actual_proportions(1:count) ...
                         - uncertainty_estimated_proportions(1:count)).^2))) ...
        ]);
  disp(['battleship: mae ' ...
        num2str(mean(abs(actual_proportions(1:count) ...
                         - battleship_estimated_proportions(1:count)))) ...
        ', rmse ' ...
        num2str(sqrt(mean((actual_proportions(1:count) ...
                         - battleship_estimated_proportions(1:count)).^2))) ...
        ]);
  disp(['optimal: mae ' ...
        num2str(mean(abs(actual_proportions(1:count) ...
                         - optimal_estimated_proportions(1:count)))) ...
        ', rmse ' ...
        num2str(sqrt(mean((actual_proportions(1:count) ...
                         - optimal_estimated_proportions(1:count)).^2))) ...
        ]);

  save([results_directory '/' num2str(count)]);
end